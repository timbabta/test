<?php
//ini_set('error_reporting', E_ALL);
//ini_set('display_errors', 1);
//ini_set('display_startup_errors', 1);
// –æ–ø—Ä–µ–¥–µ–ª–∏–º –∫–æ–¥–∏—Ä–æ–≤–∫—É UTF-8
header("HTTP/1.1 200 OK");
header('Content-type: text/html; charset=utf-8');
// —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –º–∞–≥–∞–∑–∏–Ω–∞
$newShop = new ShopBot();
// –∑–∞–ø—É—Å–∫–∞–µ–º –º–∞–≥–∞–∑–∏–Ω
$newShop->init();

/** –ö–ª–∞—Å—Å –ú–∞–≥–∞–∑–∏–Ω–∞
 * Class ShopBot
 */
class ShopBot
{
    // –ø–µ—Ä–≤–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
//    private $token = "5104085784:AAEiwPaUWQfQ9dPdWuz8Lqlfl1VCR5NbP64";

    private $token = "5102679784:AAFyTO7VueXRnzCr_BXCYMtORE_woRmdBig";
    private $admin = "866537385"; // –í–∞—à id –≤ –¢–ï–õ–µ–ì–†–ê–ú
//    private $admin = "-554738564";
    private $helloText = "–ü—Ä–∏–≤–µ—Ç, ";
    private $img_path = "img"; // –ø—É—Ç—å –¥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞


    // –Ø–Ω–¥–µ–∫—Å.–ö–æ—à–µ–ª–µ–∫ –¥–ª—è –ø—Ä–∏–µ–º–∞ –æ–ø–ª–∞—Ç—ã
    private $receiver = "–í–ê–®_–Ø–ù–î–ï–ö–°_–ö–û–®–ï–õ–ï–ö";
    // –∞–¥—Ä–µ—Å –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–∞–¥—Ä–µ—Å—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
    private $urlBot = "t.me/bon_username";
    // –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
    private $nameShop = "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä";


    // –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î
    private $host = 'localhost';
    private $db = 'telebot';
    private $user = 'crocususer';
    private $pass = 'kingtw89';
    private $charset = 'utf8mb4';
    /**
     * @var PDO
     */
    private $pdo;

    //////////////////////////////////
    // –ó–∞–ø—É—Å–∫–∞–µ–º –º–∞–≥–∞–∑–∏–Ω
    //////////////////////////////////
    /** –°—Ç–∞—Ä—Ç—É–µ–º  –±–æ—Ç–∞
     * @return bool
     */
    public function init()
    {
        // —Å–æ–∑–¥–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        $this->setPdo();
        // –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç –ê–ü–ò –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏—Ö –≤ –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤
        $rawData = json_decode(file_get_contents('php://input'), true);
        // –Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–æ—Ç–∞ –≤ –º–µ—Ç–æ–¥
        // –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏–π
        $this->router($rawData);
        // –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ –≤–µ—Ä–Ω–µ–º true –¥–ª—è –±–æ—Ç –∞–ø–∏
        return true;
    }

    /** –†–æ—É—Ç–µ—Ä - –û–ø—Ä–µ–¥–µ–ª—è–µ–º —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ—Ç –ê–ü–ò
     * @param $data
     * @return bool
     */
    private function router($data)
    {
        // –±–µ—Ä–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ id —á–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è == –µ–≥–æ id –∏ —Ç–µ–∫—Å—Ç –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–µ–ª
        $chat_id = $this->getChatId($data);
        $text = $this->getText($data);

        // –µ—Å–ª–∏ –ø—Ä–∏—à–ª–∏ –¥–∞–Ω–Ω—ã–µ message
        if (array_key_exists("message", $data)) {
            // –¥–∞—Å—Ç–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –∞–¥–º–∏–Ω–∞ –∏–∑ –±–∞–∑—ã
            $action = $this->getAdminAction();
            $actionUser = $this->getUserAction($chat_id);
            $feedUser = $this->getUserFeed($chat_id);

            // —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            if (array_key_exists("text", $data['message'])) {

                // –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–∏—à–µ–ª —Å—Ç–∞—Ä—Ç –±–æ—Ç–∞
                if ($text == "/start") {
                    $this->gostart($chat_id, $data);
                } elseif ($text == "/admin" && $this->isAdmin($chat_id)) {
                    // –≤—ã–≤–æ–¥–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É
                    $this->adminPage($chat_id);
                } elseif ($text == "/admincategory" && $this->isAdmin($chat_id)) {
                    // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                    $this->adminCategory();
                } elseif ($text == "/addcategory" && $this->isAdmin($chat_id)) {
                    // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    $this->addCategory();
                } elseif ($text == "/admincontact" && $this->isAdmin($chat_id)) {
                    // –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
                    $this->adminContact();
                } elseif ($text == "/orders" && $this->isAdmin($chat_id)) {
                    // –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤
                    $this->showOrders();
 		} elseif ($text == "/mailing" && $this->isAdmin($chat_id)) {
                    // –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤
                    $this->goMailing();
		 } elseif ($text == "üöò –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑") {
			  $this->setOrder($data);
		} elseif ($text == "üõí –ö–æ—Ä–∑–∏–Ω–∞") {
                    // –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    $this->showBasket($data);
		} elseif ($text == "üí¨ –û –Ω–∞—Å") {
 		    $this->oNas($chat_id,$data);
                } elseif ($text == "üí¶ –í–æ–¥–∞") {
                    // –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    $this->goshowBasket($data,'2');
		} elseif ($text == "üçº –¢–∞—Ä–∞") {
		    $this->goshowBasket($data,'8');

		} elseif ($text == "‚ùå –ó–∞–∫—Ä—ã—Ç—å —á–∞—Ç") {
			  $this->showMenu($chat_id,$data,"–ß–∞—Ç-–±–æ—Ç —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ Crocus");
			$this->setFeedUser(0, $chat_id);
                } elseif ($text == "üìù –ú–æ–∏ –∑–∞–∫–∞–∑—ã") {
                    // –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    $this->userLc($chat_id);
	        } elseif ($text == "üë©‚Äçüíª –°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º"){
                        $this->goChat($data);
		} elseif ($text == "–ú–Ω–µ –ø–æ–Ω—è—Ç–Ω–æ, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´–ú–µ–Ω—é –∫–Ω–æ–ø–æ–∫¬ª") {
                    $this->showMenu($chat_id,$data,"–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!");
		} elseif ($text == "üìã –ú–µ–Ω—é") {
 		    $this->goMenu($chat_id,$data);
               } elseif ($text == "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑") {
			$this->goBackmenu($data);
		} elseif ($text == "/menu") {
			$this->setFeedUser(0, $chat_id);

 		    $this->showMenu($chat_id,$data,"–ß–∞—Ç-–±–æ—Ç —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ Crocus");
		} elseif ($text == "üìã –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é") {
		    $this->showMenu($chat_id,$data,"–ß–∞—Ç-–±–æ—Ç —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ Crocus");
		    $this->setFeedUser(0, $chat_id);
                } else { // –¥—Ä—É–≥–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    // —Å–º–æ—Ç—Ä–∏–º –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    if ($action == "addcategory" && $this->isAdmin($chat_id)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        $this->adderCategory($text);
		   } elseif (preg_match("~^feedback~", $action) && $this->isAdmin($chat_id)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ step_1 - –Ω–∞–∑–≤–∞–Ω–∏–µ
			$this->feedBack($data);

                    } elseif (preg_match("~^addproduct_1_~", $action) && $this->isAdmin($chat_id)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ step_1 - –Ω–∞–∑–≤–∞–Ω–∏–µ
                        $param = explode("_", $action);
                        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
                        $this->addProductName($param['2'], $text);

                    } elseif (preg_match("~^addproduct_2_~", $action) && $this->isAdmin($chat_id)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ step_2 - –æ–ø–∏—Å–∞–Ω–∏–µ
                        $param = explode("_", $action);
                        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
                        $this->addProductDescription($param['2'], $param['3'], $text);
                    } elseif (preg_match("~^addproduct_3_~", $action) && $this->isAdmin($chat_id)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ step_3 - –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
                        $param = explode("_", $action);
                        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
                        $this->addProductPrice($param['2'], $param['3'], $text);
                    } elseif (preg_match("~^addproduct_4_~", $action) && $this->isAdmin($chat_id)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ step_4 - —Ü–µ–Ω–∞
                        $param = explode("_", $action);
                        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
                        $this->addProductUnit($param['2'], $param['3'], $text);
                    } elseif (preg_match("~^addcontact_~", $action) && $this->isAdmin($chat_id)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
                        $param = explode("_", $action);
                        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
                        $this->rederContact($param[1], $text);
 		   } elseif (preg_match("~^1$~", $feedUser)) {
			 $this->feedBack($data);

                    } elseif (preg_match("~^step_1_del$~", $actionUser)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                        $this->saveDelUser($text, $data);
		    } elseif (preg_match("~^gostart$~", $actionUser)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                        $this->sendIdent($chat_id, $data);
		    } elseif (preg_match("~^step_3_phone$~", $actionUser)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞
                        $this->savePhoneUser($text, $data);
                    } elseif (preg_match("~^step_2_adress$~", $actionUser)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞
                        $this->saveAdressUser($text, $data);
		   } elseif (preg_match("~^step_4_ready$~", $actionUser)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞
                        $this->goSetOrder($text, $data);
                    } else { // –µ—Å–ª–∏ –Ω–µ –∂–¥–µ–º –Ω–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
                        $this->showMenu($chat_id,$data,"–ß–∞—Ç-–±–æ—Ç —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ Crocus");

                    }
                }
            } elseif (array_key_exists("photo", $data['message'])) {
                // –µ—Å–ª–∏ –ø—Ä–∏—à–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –µ—Å–ª–∏ –∂–¥–µ–º
                if (preg_match("~^addproduct_5_~", $action) && $this->isAdmin($chat_id)) {
                    // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ step_5 - –∫–∞—Ä—Ç–∏–Ω–∫–∞
                    $param = explode("_", $action);
                    // –±–µ—Ä–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
                    $file_id = end($data['message']['photo'])['file_id'];
                    // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
                    $this->addProductPhoto($param['2'], $param['3'], $file_id);

		} elseif (preg_match("~^1$~", $feedUser)) {
                         $this->feedBack($data);
//    $this->sendMessage($chat_id, "–ù–∞–º –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ. –°–ø–∞");

		} elseif (preg_match("~^feedback~", $action) && $this->isAdmin($chat_id)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ step_1 - –Ω–∞–∑–≤–∞–Ω–∏–µ
                        $this->feedBack($data);
  // $this->sendMessage($chat_id, "–ù–∞–º –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ. –°–ø");


 		} else {
                    $this->sendMessage($chat_id, "–ù–∞–º –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ. –°–ø–∞—Å–∏–±–æ.");
                }
	   } elseif (array_key_exists("contact", $data['message'])  && preg_match("~^gostart$~", $actionUser)) {
		$this->saveReal($chat_id, $data);

            } else {
		if (preg_match("~^1$~", $feedUser)) {
                         $this->feedBack($data);
    //$this->sendMessage($chat_id, "–ù–∞–º –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ. –°–ø–∞—Å–∏.");

                } elseif (preg_match("~^feedback~", $action) && $this->isAdmin($chat_id)) {
                        // –µ—Å–ª–∏ –∂–¥–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ step_1 - –Ω–∞–∑–≤–∞–Ω–∏–µ
                        $this->feedBack($data);
    //$this->sendMessage($chat_id, "–ù–∞–º –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ. –°–ø–∞—Å–∏–±.");

		} else {
	 // –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ - –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å—Ç–∏–∫–µ—Ä—ã –∞—É–¥–∏–æ ...
//               $this->sendMessage($chat_id, "–ù–∞–º –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ. –°–ø–∞—Å–∏–±–æ.");
			}
            }
        } // –µ—Å–ª–∏ –ø—Ä–∏—à–µ–ª –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
        elseif (array_key_exists("callback_query", $data)) {
            // —Å–º–æ—Ç—Ä–∏–º –∫–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
            $func_param = explode("_", $text);
            // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
            $func = $func_param[0];
            // –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–µ–¥–∞–µ–º –µ–π –≤–µ—Å—å –æ–±—ä–µ–∫—Ç
            $this->$func($data['callback_query']);
        } // –ó–¥–µ—Å—å –ø—Ä–∏—à–ª–∏ –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã–µ –Ω–∞–º —Ñ–æ—Ä–º–∞—Ç—ã
        else {
            // –≤–µ—Ä–Ω–µ–º —Ç–µ–∫—Å—Ç —Å –æ—à–∏–±–∫–æ–π
//            $this->sendMessage($chat_id, "–ù–∞–º –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ. –°–ø–∞—Å–∏–±–æ.");
        }
        return true;
    }

    //////////////////////////////////
    // –†–∞–±–æ—á–∏–µ –º–µ—Ç–æ–¥—ã
    //////////////////////////////////
    /** –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
     * @param $id
     * @param $text
     */
  private function goBackmenu($data)
     {
	 $chat_id = $this->getChatId($data);
	$this->showMenu($chat_id,$data,"–ß–∞—Ç-–±–æ—Ç —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ Crocus");

         @$this->setActionUser("", $chat_id);
    }

     private function goStart($chat_id, $data)
     {
	 $user = $this->pdo->prepare("SELECT * FROM bot_shop_profile WHERE user_id = :user_id");
         $user->execute(['user_id' => $chat_id]);
	  if ($user->rowCount() == 0) {
		$newUser = $this->pdo->prepare("INSERT INTO bot_shop_profile SET user_id = :user_id, first_name = :first_name, last_name = :last_name,   action = 'start'");
            $newUser->execute([
                'user_id' => $chat_id,
                'first_name' => $data['message']['chat']['first_name'],
		'last_name' =>  $data['message']['chat']['last_name'],

                 ]);
	$text="–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç\n\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É ¬´–û—Ç–ø—Ä–∞–≤—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç¬ª";

        $buttons_[0] = [
             $this->buildKeyboardButton("–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç",true),
          ];
        $this->sendMessage($chat_id,$text,$buttons_,true);
 	 @$this->setActionUser("gostart", $chat_id);
	}else{
		if(strlen($user->fetch()['realphone']) > 10){
		@$this->setActionUser("start", $chat_id);
		$this->startBot($chat_id, $data);
	         } else{ 
      $text="–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É ¬´–û—Ç–ø—Ä–∞–≤—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç¬ª";

        $buttons_[0] = [
             $this->buildKeyboardButton("–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç",true),
          ];
        $this->sendMessage($chat_id,$text,$buttons_,true);
	@$this->setActionUser("gostart", $chat_id);
		}
 	}
    }

    private function sendIdent($chat_id, $data)
    {
	if(array_key_exists("contact", $data['message'])) {
             //   $this->sendPhone($chat_id, $data['message']['contact']['phone_number'])
  	@$this->setActionUser("sendphone", $chat_id);
	$this->goStart($chat_id, $data);

	}else{
	$this->goStart($chat_id, $data);
	}
    }

  private function saveReal($chat_id, $data)
    {
   $update = $this->pdo->prepare("UPDATE bot_shop_profile SET realphone = :realphone WHERE user_id = :user_id");
        // –µ—Å–ª–∏ –æ–±–Ω–æ–≤–∏–ª–∏ —Ç–æ –≤—ã–≤–æ–¥–∏–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
        if ($update->execute(['user_id' => $chat_id, 'realphone' => $data['message']['contact']['phone_number']])) {
            // –æ—á–∏—â–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∞
            // –≤—ã–≤–æ–¥–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            $this->startBot($chat_id, $data);
	@$this->setActionUser("start", $chat_id);

        } else {
            $this->sendMessage($chat_id, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤.");
        }

    }

    private function rederContact($id, $text)
    {
        // –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        $update = $this->pdo->prepare("UPDATE bot_shop_contact SET description = :description WHERE id = :id");
        // –µ—Å–ª–∏ –æ–±–Ω–æ–≤–∏–ª–∏ —Ç–æ –≤—ã–≤–æ–¥–∏–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
        if ($update->execute(['id' => $id, 'description' => $text])) {
            // –æ—á–∏—â–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∞
            $this->adminActionCancel();
            // –≤—ã–≤–æ–¥–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            $this->adminContact();
        } else {
            $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤. \n/admin");
        }
    }

    /** –§–æ—Ä–º–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
     * @param $data
     */
    private function redContact($data)
    {
        // –±–µ—Ä–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏
        $obj = $data['data'];
        // —Ä–∞–∑–±–∏–≤–∞–µ–º –≤ –º–∞—Å—Å–∏–≤
        $param = explode("_", $obj);
        if ($this->setActionAdmin("addcontact_" . $param[1])) {
            // –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ
            $text = "<b>–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –¥–∞–Ω–Ω—ã—Ö:</b>\n";
            $text .= $this->prepareContact()[0] . "\n\n";
            $text .= "–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:";
            // —Å–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Å –¥–∞–Ω–Ω—ã–º–∏
            $fields = [
                'chat_id' => $this->admin,
                'text' => $text,
                'parse_mode' => 'html',
                'message_id' => $data['message']['message_id'],
            ];
            // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            $upMessage = $this->botApiQuery("editMessageText", $fields);
            // –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ
            if ($upMessage['ok']) {
                $this->notice($data['id'], "–£–∫–∞–∂–∏—Ç–µ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ");
            } else {
                $this->notice($data['id'], "–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ä–º—ã");
            }
        } else {
            $this->notice($data['id'], "–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è");
        }
    }

    /**
     *  –≤—ã–≤–æ–¥–∏–º –∞–¥–º–∏–Ω—É –∫–æ–Ω—Ç–∞–∫—Ç—ã —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
     */
    private function adminContact()
    {
        //–æ—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
        $this->cleareTempProduct();
        // –æ—á–∏—â–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∞
        $this->adminActionCancel();
        // –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        $item = $this->prepareContact();
        // –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥
        $buttons[] = [
            $this->buildInlineKeyBoardButton("–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", "redContact_" . $item[1]),
        ];
        // –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ
        $fields = [
            'chat_id' => $this->admin,
            'text' => "<b>–ö–æ–Ω—Ç–∞–∫—ã –º–∞–≥–∞–∑–∏–Ω–∞</b>\n\n" . $item[0] . "\n\n/admin",
            'parse_mode' => 'html',
            'reply_markup' => $this->buildInlineKeyBoard($buttons),
        ];
        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        $this->botApiQuery("sendMessage", $fields);
    }

    /** –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
     * @return array
     */
    private function prepareContact()
    {
        // –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        $contact = $this->pdo->query("SELECT * FROM bot_shop_contact ORDER BY id DESC LIMIT 1");
        // –ø–∞—Ä—Å–∏–º –≤ –º–∞—Å—Å–∏–≤
        $item = $contact->fetch();
        // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        return [$item['description'], $item['id']];
    }

    /** –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞
     * @param $data
     */

    private function showProduct($data)
    {
        // –±–µ—Ä–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏
        $obj = $data['data'];
        // —Ä–∞–∑–±–∏–≤–∞–µ–º –≤ –º–∞—Å—Å–∏–≤
        $param = explode("_", $obj);
        // –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤ –±–∞–∑–µ
        $checkHref = $this->pdo->prepare("SELECT * FROM bot_shop_product WHERE id = :id");
        // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        $checkHref->execute(['id' => $param[1]]);
        // –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–æ—Å—å –Ω–æ–ª—å —Å—Ç—Ä–æ–∫
        if ($checkHref->rowCount() === 0) {
            // –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É
            $this->notice($data['id'], "–°—Å—ã–ª–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞");
            // —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏–∑ —á–∞—Ç–∞
            $this->botApiQuery("deleteMessage", ['chat_id' => $this->admin, 'message_id' => $data['message']['message_id']]);
        } else {
            // –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞
            $item = $checkHref->fetch();
            // –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            $catName = $this->pdo->prepare("SELECT name FROM bot_shop_category WHERE id = :id");
            $catName->execute(['id' => $item['parent']]);
            // –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥
            $buttons[] = [
                $this->buildInlineKeyBoardButton("–ù–∞–∑–∞–¥", "showCategory_" . $item['parent']),
            ];

            $text = "–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: " . $catName->fetch()['name'] . "\n\n";

            $text .= $this->prepareProduct($param[1]);

            $fields = [
                'chat_id' => $this->admin,
                'text' => $text,
                'parse_mode' => 'html',
                'message_id' => $data['message']['message_id'],
                'reply_markup' => $this->buildInlineKeyBoard($buttons),
            ];
            // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            $upMessage = $this->botApiQuery("editMessageText", $fields);
            // –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ
            if ($upMessage['ok']) {
                $this->notice($data['id'], "–¢–æ–≤–∞—Ä –ø–æ–∫–∞–∑–∞–Ω");
            } else {
                $this->notice($data['id'], "–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞");
            }
        }
    }

	 private function goshowProduct2($data,$id)
	    {
 	$chat_id = $this->getChatId($data);
 	@$this->setActionUser("cat", $chat_id);
	$this->showBasketBegin2($chat_id,$data);

	    }

     private function showProduct2($data,$id)
    {
 	$chat_id = $this->getChatId($data);

	@$this->setActionUser("", $chat_id);

        // –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤ –±–∞–∑–µ
        $checkHref = $this->pdo->prepare("SELECT * FROM bot_shop_product WHERE id = :id");
        // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        $checkHref->execute(['id' => $id]);
        // –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–æ—Å—å –Ω–æ–ª—å —Å—Ç—Ä–æ–∫
        if ($checkHref->rowCount() === 0) {
            // –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É
        //    $this->notice($data['id'], "–°—Å—ã–ª–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞");
            // —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏–∑ —á–∞—Ç–∞
          //  $this->botApiQuery("deleteMessage", ['chat_id' => $this->admin, 'message_id' => $data['message']['message_id']]);
        } else {
            // –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥
            $buttons[] = [
                $this->buildInlineKeyBoardButton("Test", "showCategory_0"),
            ];
	$text ='test1';
 	$photo = $checkHref->fetch()['image'];
	$buttons_ = $this->buildInlineKeyBoard($buttons);

	$this->sendPhoto($chat_id,$photo,$text,$buttons_);

        }
    }


    /** —É–¥–∞–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
     * @param $data
     */
    private function deleteProduct($data)
    {
        // –±–µ—Ä–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏
        $obj = $data['data'];
        // —Ä–∞–∑–±–∏–≤–∞–µ–º –≤ –º–∞—Å—Å–∏–≤
        $param = explode("_", $obj);
        // –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤ –±–∞–∑–µ
        $checkHref = $this->pdo->prepare("SELECT * FROM bot_shop_product WHERE id = :id");
        // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        $checkHref->execute(['id' => $param[1]]);
        // –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–æ—Å—å –Ω–æ–ª—å —Å—Ç—Ä–æ–∫
        if ($checkHref->rowCount() === 0) {
            // –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É
            $this->notice($data['id'], "–°—Å—ã–ª–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞");
            // —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏–∑ —á–∞—Ç–∞
            $this->botApiQuery("deleteMessage", ['chat_id' => $this->admin, 'message_id' => $data['message']['message_id']]);
        } else {
            // –≥–æ—Ç–æ–≤–∏–º –∑–∞–ø—Ä–æ—Å
            $deleteSql = $this->pdo->prepare("DELETE FROM bot_shop_product WHERE id = :id");
            // —É–¥–∞–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            if ($deleteSql->execute(['id' => $param[1]])) {
                // –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞
                $item = $checkHref->fetch();
                // –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                $catName = $this->pdo->prepare("SELECT name FROM bot_shop_category WHERE id = :id");
                $catName->execute(['id' => $item['parent']]);
                // –ø–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                $fields = $this->prepareCategory($catName->fetch()['name'], $item['parent']);
                // –¥–æ–±–∞–≤–ª—è–µ–º –∫ –º–∞—Å—Å–∏–≤—É id —Å–æ–æ–±—â–µ–Ω–∏—è
                $fields['message_id'] = $data['message']['message_id'];
                // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                $upMessage = $this->botApiQuery("editMessageText", $fields);
                // –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ
                if ($upMessage['ok']) {
                    $this->notice($data['id'], "–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω");
                } else {
                    $this->notice($data['id'], "–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π");
                }
            } else {
                $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞.");
            }
        }
    }

    /** –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞
     * @param $data
     */
    private function hideProduct($data)
    {
        // –±–µ—Ä–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏
        $obj = $data['data'];
        // —Ä–∞–∑–±–∏–≤–∞–µ–º –≤ –º–∞—Å—Å–∏–≤
        $param = explode("_", $obj);
        // –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤ –±–∞–∑–µ
        $checkHref = $this->pdo->prepare("SELECT * FROM bot_shop_product WHERE id = :id");
        // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        $checkHref->execute(['id' => $param[1]]);
        // –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–æ—Å—å –Ω–æ–ª—å —Å—Ç—Ä–æ–∫
        if ($checkHref->rowCount() === 0) {
            // –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É
            $this->notice($data['id'], "–°—Å—ã–ª–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞");
            // —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏–∑ —á–∞—Ç–∞
            $this->botApiQuery("deleteMessage", ['chat_id' => $this->admin, 'message_id' => $data['message']['message_id']]);
        } else {
            // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –µ—Å–ª–∏ –±—ã–ª 1 —Å—Ç–∞–≤–∏–º 0 –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
            $hide = $param[2] ? 0 : 1;
            // –≥–æ—Ç–æ–≤–∏–º –∑–∞–ø—Ä–æ—Å
            $updateSql = $this->pdo->prepare("UPDATE bot_shop_product SET hide = :hide WHERE id = :id");
            // –æ–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å
            if ($updateSql->execute(['hide' => $hide, 'id' => $param[1]])) {
                // –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞
                $item = $checkHref->fetch();
                // –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                $catName = $this->pdo->prepare("SELECT name FROM bot_shop_category WHERE id = :id");
                $catName->execute(['id' => $item['parent']]);
                // –ø–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                $fields = $this->prepareCategory($catName->fetch()['name'], $item['parent']);
                // –¥–æ–±–∞–≤–ª—è–µ–º –∫ –º–∞—Å—Å–∏–≤—É id —Å–æ–æ–±—â–µ–Ω–∏—è
                $fields['message_id'] = $data['message']['message_id'];
                // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                $upMessage = $this->botApiQuery("editMessageText", $fields);
                // –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ
                if ($upMessage['ok']) {
                    $this->notice($data['id'], "–í–∏–¥–∏–º–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∞");
                } else {
                    $this->notice($data['id'], "–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π");
                }
            } else {
                $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞");
            }
        }
    }

    /** –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ–º —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–∞
     * @param $category
     * @param $product
     * @param $file_id
     */
    private function addProductPhoto($category, $product, $file_id)
    {
        // –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Ç–æ–≤–∞—Ä–∞ –≤ –±–∞–∑–µ
        $checkHref = $this->pdo->prepare("SELECT * FROM bot_shop_product_temp WHERE id = :id");
        // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        $checkHref->execute(['id' => $product]);
        // –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–æ—Å—å –Ω–æ–ª—å —Å—Ç—Ä–æ–∫
        if ($checkHref->rowCount() !== 0) {
            // –ø–æ–ª—É—á–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
            $photo = $this->getPhoto($file_id);
            if ($photo) {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
                $insert = $this->pdo->prepare("INSERT INTO bot_shop_product SET parent = :parent, name = :name, description = :description, price = :price, unit = :unit, image_tlg = :image_tlg, image = :image, hide = 1");
                // –¥–æ—Å—Ç–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                $item = $checkHref->fetch();
                // –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ
                $array = [
                    'parent' => $category,
                    'name' => $item['name'],
                    'description' => $item['description'],
                    'price' => $item['price'],
                    'unit' => $item['unit'],
                    'image_tlg' => $file_id,
                    'image' => $photo
                ];
                // –µ—Å–ª–∏ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                if ($insert->execute($array)) {
                    //–æ—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
                    $this->cleareTempProduct();
                    // –æ—á–∏—â–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∞
                    $this->adminActionCancel();
                    // –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    $catName = $this->pdo->prepare("SELECT name FROM bot_shop_category WHERE id = :id");
                    $catName->execute(['id' => $category]);
                    // –≤—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
                    $fields = $this->prepareCategory($catName->fetch()['name'], $category);
                    // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ - –≤—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
                    $this->botApiQuery("sendMessage", $fields);
                } else {
                    $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ 0");
                }
            } else {
                $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ 1");
            }
        } else {
            $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ 2");
        }
    }

    /** –æ–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏
     * @param $file_id
     * @return bool|string
     */
    private function getPhoto($file_id)
    {
        // –ø–æ–ª—É—á–∞–µ–º file_path
        $file_path = $this->getPhotoPath($file_id);
        // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        return $this->copyPhoto($file_path);
    }

    /** —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è —Ñ–∞–π–ª–∞
     * @param $file_id
     * @return mixed
     */
    private function getPhotoPath($file_id)
    {
        // –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç File
        $array = $this->botApiQuery("getFile", ['file_id' => $file_id]);
        // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º file_path
        return $array['result']['file_path'];
    }

    /** –∫–æ–ø–∏—Ä—É–µ–º —Ñ–æ—Ç–æ –∫ —Å–µ–±–µ
     * @param $file_path
     * @return bool|string
     */
    private function copyPhoto($file_path)
    {
        // —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ
        $file_from_tgrm = "https://api.telegram.org/file/bot" . $this->token . "/" . $file_path;
        // –¥–æ—Å—Ç–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        $ext = end(explode(".", $file_path));
        // –Ω–∞–∑–Ω–∞—á–∞–µ–º —Å–≤–æ–µ –∏–º—è –∑–¥–µ—Å—å –≤—Ä–µ–º—è_–≤_—Å–µ–∫—É–Ω–¥–∞—Ö.—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ_—Ñ–∞–π–ª–∞
        $name_our_new_file = $this->img_path . "/" . time() . "." . $ext;
        // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏–ª–∏ false
        return copy($file_from_tgrm, $name_our_new_file) ? $name_our_new_file : false;
    }

    /** –î–æ–±–∞–≤–ª—è–µ–º –µ–¥–µ–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è
     * @param $category
     * @param $product
     * @param $text
     */
    private function addProductUnit($category, $product, $text)
    {
        // –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Ç–æ–≤–∞—Ä–∞ –≤ –±–∞–∑–µ
        $checkHref = $this->pdo->prepare("SELECT * FROM bot_shop_product_temp WHERE id = :id");
        // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        $checkHref->execute(['id' => $product]);
        // –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–æ—Å—å –Ω–æ–ª—å —Å—Ç—Ä–æ–∫
        if ($checkHref->rowCount() !== 0) {
            // –≥–æ—Ç–æ–≤–∏–º –∑–∞–ø—Ä–æ—Å
            $update = $this->pdo->prepare("UPDATE bot_shop_product_temp SET unit = :unit WHERE id = :id");
            // –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ç–æ –ø—Ä–æ—Å–∏–º –¥–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
            if ($update->execute(['id' => $product, 'unit' => $text])) {
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–π—Å–≤—Ç–∏–µ –∞–¥–º–∏–Ω–∞ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
                if ($this->setActionAdmin("addproduct_5_" . $category . "_" . $product)) {
                    // –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    $cat = $this->pdo->prepare("SELECT * FROM bot_shop_category WHERE id = :id");
                    // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
                    $cat->execute(['id' => $category]);
                    // –≥–æ—Ç–æ–≤–∏–º —Ç–µ–∫—Å—Ç
                    $text = "–ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é: " . $cat->fetch()['name'] . "\n\n";
                    // –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ —Ç–æ–≤–∞—Ä–µ
                    $text .= $this->prepareProduct($product, "_temp");
                    // –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                    $text .= "\n–î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫—É –¥–ª—è —Ç–æ–≤–∞—Ä–∞:";
                    // –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–º–µ–Ω–∏—Ç—å
                    $buttons[] = [
                        $this->buildInlineKeyBoardButton("–û—Ç–º–µ–Ω–∏—Ç—å", "addProductCancel_" . $category . "_" . $product),
                    ];
                    $fields = [
                        'chat_id' => $this->admin,
                        'text' => $text,
                        'reply_markup' => $this->buildInlineKeyBoard($buttons),
                        'parse_mode' => 'html',
                    ];
                    // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    $this->botApiQuery("sendMessage", $fields);
                }
            } else {
                $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ 1");
            }
        } else {
            $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ 2");
        }
    }

    /** –î–æ–±–∞–≤–ª—è–µ–º —Ü–µ–Ω—É
     * @param $category
     * @param $product
     * @param $text
     */
    private function addProductPrice($category, $product, $text)
    {
        // –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Ç–æ–≤–∞—Ä–∞ –≤ –±–∞–∑–µ
        $checkHref = $this->pdo->prepare("SELECT * FROM bot_shop_product_temp WHERE id = :id");
        // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        $checkHref->execute(['id' => $product]);
        // –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–æ—Å—å –Ω–æ–ª—å —Å—Ç—Ä–æ–∫
        if ($checkHref->rowCount() !== 0) {
            // –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ —á–∏—Å–ª–æ –∏ –ø—Ä–∏–≤–µ—Å—Ç–≤–∏ –∏—Ö –∫ –º–æ–¥—É–ª—é
            if (!is_numeric($text)) {
                $this->sendMessage($this->admin, "–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
            } else {
                // –ø—Ä–∏–≤–æ–¥–∏–º –∫ –º–æ–¥—É–ª—é —á–∏—Å–ª—É
                $text = abs($text);
                // –≥–æ—Ç–æ–≤–∏–º –∑–∞–ø—Ä–æ—Å
                $update = $this->pdo->prepare("UPDATE bot_shop_product_temp SET price = :price WHERE id = :id");
                // –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ç–æ –ø—Ä–æ—Å–∏–º –¥–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
                if ($update->execute(['id' => $product, 'price' => $text])) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–π—Å–≤—Ç–∏–µ –∞–¥–º–∏–Ω–∞ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
                    if ($this->setActionAdmin("addproduct_4_" . $category . "_" . $product)) {
                        // –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        $cat = $this->pdo->prepare("SELECT * FROM bot_shop_category WHERE id = :id");
                        // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
                        $cat->execute(['id' => $category]);
                        // –≥–æ—Ç–æ–≤–∏–º —Ç–µ–∫—Å—Ç
                        $text = "–ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é: " . $cat->fetch()['name'] . "\n\n";
                        // –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ —Ç–æ–≤–∞—Ä–µ
                        $text .= $this->prepareProduct($product, "_temp");
                        // –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                        $text .= "\n–î–æ–±–∞–≤—å—Ç–µ –µ–¥–µ–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è:";
                        // –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–º–µ–Ω–∏—Ç—å
                        $buttons[] = [
                            $this->buildInlineKeyBoardButton("–û—Ç–º–µ–Ω–∏—Ç—å", "addProductCancel_" . $category . "_" . $product),
                        ];
                        $fields = [
                            'chat_id' => $this->admin,
                            'text' => $text,
                            'reply_markup' => $this->buildInlineKeyBoard($buttons),
                            'parse_mode' => 'html',
                        ];
                        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                        $this->botApiQuery("sendMessage", $fields);
                    }
                } else {
                    $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ 1");
                }
            }
        } else {
            $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ 2");
        }
    }

    /** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
     * @param $category
     * @param $product
     * @param $text
     */
    private function addProductDescription($category, $product, $text)
    {
        // –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Ç–æ–≤–∞—Ä–∞ –≤ –±–∞–∑–µ
        $checkHref = $this->pdo->prepare("SELECT * FROM bot_shop_product_temp WHERE id = :id");
        // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        $checkHref->execute(['id' => $product]);
        // –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–æ—Å—å –Ω–æ–ª—å —Å—Ç—Ä–æ–∫
        if ($checkHref->rowCount() !== 0) {
            $update = $this->pdo->prepare("UPDATE bot_shop_product_temp SET description = :description WHERE id = :id");
            // –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ç–æ –ø—Ä–æ—Å–∏–º –¥–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
            if ($update->execute(['id' => $product, 'description' => $text])) {
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–π—Å–≤—Ç–∏–µ –∞–¥–º–∏–Ω–∞ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
                if ($this->setActionAdmin("addproduct_3_" . $category . "_" . $product)) {
                    // –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    $cat = $this->pdo->prepare("SELECT * FROM bot_shop_category WHERE id = :id");
                    // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
                    $cat->execute(['id' => $category]);
                    // –≥–æ—Ç–æ–≤–∏–º —Ç–µ–∫—Å—Ç
                    $text = "–ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é: " . $cat->fetch()['name'] . "\n\n";
                    // –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ —Ç–æ–≤–∞—Ä–µ
                    $text .= $this->prepareProduct($product, "_temp");
                    // –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                    $text .= "\n–î–æ–±–∞–≤—å—Ç–µ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ 0 (—Ü–µ–ª–æ–µ –∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ):";
                    // –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–º–µ–Ω–∏—Ç—å
                    $buttons[] = [
                        $this->buildInlineKeyBoardButton("–û—Ç–º–µ–Ω–∏—Ç—å", "addProductCancel_" . $category . "_" . $product),
                    ];
                    $fields = [
                        'chat_id' => $this->admin,
                        'text' => $text,
                        'reply_markup' => $this->buildInlineKeyBoard($buttons),
                        'parse_mode' => 'html',
                    ];
                    // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    $this->botApiQuery("sendMessage", $fields);
                }
            } else {
                $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ 1");
            }
        } else {
            $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ 2");
        }
    }

    /** –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
     * @param $id
     * @param $text
     */
    private function addProductName($id, $text)
    {
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
        $insert = $this->pdo->prepare("INSERT INTO bot_shop_product_temp SET parent = :id, name = :name");
        // –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ç–æ –ø—Ä–æ—Å–∏–º –¥–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
        if ($insert->execute(['id' => $id, 'name' => $text])) {
            // –ø–æ–ª—É—á–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π id
            $idProduct = $this->pdo->lastInsertId();
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–π—Å–≤—Ç–∏–µ –∞–¥–º–∏–Ω–∞ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
            if ($this->setActionAdmin("addproduct_2_" . $id . "_" . $idProduct)) {
                // –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                $category = $this->pdo->prepare("SELECT * FROM bot_shop_category WHERE id = :id");
                // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
                $category->execute(['id' => $id]);
                // –≥–æ—Ç–æ–≤–∏–º —Ç–µ–∫—Å—Ç
                $text = "–ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é: " . $category->fetch()['name'] . "\n\n";
                // –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ —Ç–æ–≤–∞—Ä–µ
                $text .= $this->prepareProduct($idProduct, "_temp");
                // –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                $text .= "\n–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:";
                // –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–º–µ–Ω–∏—Ç—å
                $buttons[] = [
                    $this->buildInlineKeyBoardButton("–û—Ç–º–µ–Ω–∏—Ç—å", "addProductCancel_" . $id . "_" . $idProduct),
                ];
                $fields = [
                    'chat_id' => $this->admin,
                    'text' => $text,
                    'reply_markup' => $this->buildInlineKeyBoard($buttons),
                    'parse_mode' => 'html',
                ];
                // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                $this->botApiQuery("sendMessage", $fields);
            }
        } else {
            $this->sendMessage($this->admin, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞");
        }
    }

    /** –≥–æ—Ç–æ–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
     * @param $id
     * @param string $type
     * @return bool|string
     */
    private function prepareProduct($id, $type = "")
    {
        $product = $this->pdo->prepare("SELECT * FROM bot_shop_product" . $type . " WHERE id = :id");
        $product->execute(['id' => $id]);
        if ($product->rowCount() === 0) {
            return false;
        } else {
            $item = $product->fetch();
            // —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Å–∫–ª–∞–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
            $text = "";
            // –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–∏–∫–Ω–∏
            if (empty($item['image'])) {
                $image = "–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞";
            } else {
                // –ø–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥–æ–º–µ–Ω–∞
                $path = $_SERVER['PHP_SELF'];
                // –ø–æ–ª—É—á–∞–µ–º –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ª–µ—à–∞
                $path_len = mb_strripos($_SERVER['PHP_SELF'], "/");
                // –æ—Ç—Ä–µ–∑–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ - –ø–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –¥–æ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                $path_new = mb_strcut($path, 0, $path_len + 1);
                $image = "";
                $text .= "<a href='https://" . $_SERVER['SERVER_NAME'] . $path_new . $item['image'] . "'>&#8203;&#8203;</a>";
            }
            $text .= "<b>–ù–∞–∑–≤–∞–Ω–∏–µ: </b>" . $item['name'] . "\n";
            $text .= "<b>–û–ø–∏—Å–∞–Ω–∏–µ: </b>" . $item['description'] . "\n";
            $text .= "<b>–¶–µ–Ω–∞: </b>" . $item['price'] . "\n";
            $text .= "<b>–ï–¥.–∏–∑–º: </b>" . $item['unit'] . "\n";
            $text .= "<b>–ö–∞—Ä—Ç–∏–Ω–∫–∞: </b>" . $image . "\n";
            // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            return $text;
        }
    }
 
  private function prepareProduct2($id, $type = "")
    {
        $product = $this->pdo->prepare("SELECT * FROM bot_shop_product" . $type . " WHERE id = :id");
        $product->execute(['id' => $id]);
        if ($product->rowCount() === 0) {
            return false;
        } else {
	    $item = $product->fetch(); 
            // —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Å–∫–ª–∞–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
            $text = "";

            // –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–∏–∫–Ω–∏
            if (empty($item['image'])) {
                $image = "–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞";
            } else {
                // –ø–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥–æ–º–µ–Ω–∞
                $path = $_SERVER['PHP_SELF'];
                // –ø–æ–ª—É—á–∞–µ–º –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ª–µ—à–∞
                $path_len = mb_strripos($_SERVER['PHP_SELF'], "/");
                // –æ—Ç—Ä–µ–∑–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ - –ø–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –¥–æ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                $path_new = mb_strcut($path, 0, $path_len + 1);
                $image = "";
                $text .= "<a href='https://" . $_SERVER['SERVER_NAME'] . $path_new . $item['image'] . "'>&#8203;&#8203;</a>";
            }
	    $text .= "<b>–ö–∞—Ä—Ç–∏–Ω–∫–∞: </b>" . $image . "\n";
            $text .= "<b>–ù–∞–∑–≤–∞–Ω–∏–µ: </b>" . $item['name'] . "\n";
            $text .= "<b>–û–ø–∏—Å–∞–Ω–∏–µ: </b>" . $item['description'] . "\n";
            $text .= "<b>–¶–µ–Ω–∞: </b>" . $item['price'] . "\n";
            $text .= "<b>–ï–¥.–∏–∑–º: </b>" . $item['unit'] . "\n";
            // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            return $text;
        
       }
    }

   private function sendPhoto($id, $user_id, $buttons=NULL)
    {
        $product = $this->pdo->prepare("SELECT * FROM bot_shop_product  WHERE id = :id");
        $product->execute(['id' => $id]);
        if ($product->rowCount() === 0) {
            return false;
        } else {
            $item = $product->fetch();
            // —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Å–∫–ª–∞–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
	$data_send['reply_markup'] = $this->buildInlineKeyBoard($buttons);

            // –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–∏–∫–Ω–∏
            if (empty($item['image'])) {
                $image = "–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞";
            } else {
                // –ø–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥–æ–º–µ–Ω–∞
                $path = $_SERVER['PHP_SELF'];
                // –ø–æ–ª—É—á–∞–µ–º –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ª–µ—à–∞
                $path_len = mb_strripos($_SERVER['PHP_SELF'], "/");
                // –æ—Ç—Ä–µ–∑–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ - –ø–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –¥–æ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                $path_new = mb_strcut($path, 0, $path_len + 1);
                $image = "";
                $text = 'https://' . $_SERVER['SERVER_NAME'] . $path_new . $item['image'];
            }
	$data_send = [
            'chat_id' => $user_id,
            'photo' => $text,
	    'caption' => 'test',
	    'reply_markup' => $buttons,
        ];
        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        return $this->botApiQuery("sendPhoto", $data_send);


       }
    }

  private function goMailing() 
   {
	  $buttons[] = [
                $this->buildInlineKeyBoardButton("–¢–µ–∫—Å—Ç", "malibu_text"),
			];
	$buttons[] = [
		$this->buildInlineKeyBoardButton("–ö–∞—Ä—Ç–∏–Ω–∫–∞", "malibu_pic"),
			];
        $buttons[] = [
                $this->buildInlineKeyBoardButton("–¢–µ–∫—Å—Ç + –ö–∞—Ä—Ç–∏–Ω–∫–∞", "malibu_textpic"),
			];
        $buttons[] = [
 		$this->buildInlineKeyBoardButton("–í–∏–¥–µ–æ", "malibu_vid"),
			];
        $buttons[] = [
                $this->buildInlineKeyBoardButton("–¢–µ–∫—Å—Ç + –í–∏–¥–µ–æ", "malibu_textvid"),
			];
        $buttons[] = [

                $this->buildInlineKeyBoardButton("<< –ù–∞–∑–∞–¥", "goBack_0"),
            ];

	$this->adminActionCancel();
	$text ="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—Å–ª—ã–∫–∏";
 		$fields = [
                    'chat_id' => $this->admin,
                    'text' => $text,
                    'reply_markup' => $this->buildInlineKeyBoard($buttons),
                    'parse_mode' => 'html',
                ];
                // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                $this->botApiQuery("sendMessage", $fields);
   }


private function malibu($data)
    {
$chat_id= $this->admin;
  $obj = $data['data'];
